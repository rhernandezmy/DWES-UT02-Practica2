<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:f="jakarta.faces.core"
      xmlns:ui="jakarta.faces.facelets"
      xmlns:c="jakarta.tags.core">

<h:head>
    <title>Ejemplo02 usando JSF con Jakarta EE 10</title>
    <meta charset="UTF-8"/>
    <style>
        .no-pagado { color:red; font-weight:bold; }
        .ok { color:green; font-weight:bold; }
        .error { color:red; font-weight:bold; }
        table { border-collapse: collapse; margin-bottom: 20px; }
        td, th { border:1px solid #aaa; padding:6px; }
    </style>
</h:head>

<h:body>
    <h1>Hola desde JSF, </h1>
    <h2>Ejercicio ampliado con bucles y condicionales</h2>

 <!-- Pr√°ctica 2 -->
    <!-- Recorremos la lista de usuarios -->
    <ui:repeat value="#{helloBean.usuarios}" var="u">
        <div class="user-card">
            <!-- Tabla de datos personales -->
            <h2>#{u.nombre} #{u.apellidos}</h2>

            <table class="user-table">
                <tr>
                    <th>Nombre</th>
                    <td>#{u.nombre}</td>
                    <th>Apellidos</th>
                    <td>#{u.apellidos}</td>
                </tr>
                <tr>
                    <th>DNI</th>
                    <td>#{u.dni}</td>
                    <th>Email</th>
                    <td>#{u.email}</td>
                </tr>
                <tr>
                    <th>Edad</th>
                    <td>#{u.edad}</td>
                    <th></th>
                    <td></td>
                </tr>
            </table>

            <!-- Tabla de pagos mensuales-->
            <table class="payments-table">
                <thead>
                    <tr>
                        <th>Mes</th>
                        <th>Importe</th>
                    </tr>
                </thead>
                <tbody>
                    <ui:repeat value="#{helloBean.meses}" var="mes">
                        <tr>
                            <td>#{mes}</td>
                            <td>
                                <!-- Si existe importe, lo mostramos -->
                                <h:panelGroup rendered="#{not empty u.pagos[mes]}">
                                    <h:outputText value="#{u.pagos[mes]}">
                                        <f:convertNumber type="currency" currencySymbol="‚Ç¨"/>
                                    </h:outputText>
                                </h:panelGroup>

                                <!-- Si es null o vac√≠o, mostramos NO PAGADO en rojo -->
                                <h:outputText value="NO PAGADO" style="color:red;" rendered="#{empty u.pagos[mes]}"/>
                            </td>
                        </tr>
                    </ui:repeat>
                </tbody>
                <tfoot>
                    <tr>
                        <th>Total anual</th>
                        <td>
                            <h:outputText value="#{helloBean.totalPagos(u)}">
                                <f:convertNumber type="currency" currencySymbol="‚Ç¨"/>
                            </h:outputText>
                        </td>
                    </tr>
                </tfoot>
            </table>

            <!-- üî• CONDICIONAL SEG√öN TOTAL DE PAGOS -->
            <h:panelGroup rendered="#{helloBean.totalPagos(u) lt 100}">
                <p style="color:red; font-weight:bold;">
                    El usuario no est√° al d√≠a con la cuota.
                </p>
            </h:panelGroup>

            <h:panelGroup rendered="#{helloBean.totalPagos(u) ge 100}">
                <p style="color:green; font-weight:bold;">
                    El usuario est√° al corriente de pagos.
                </p>
            </h:panelGroup>

        </div>
    </ui:repeat>

    <h2>Lista de productos (con bucle ui:repeat):</h2>
    <ul>
        <ui:repeat value="#{helloBean.productos}" var="p">
            <li>
                #{p.nombre} - #{p.precio} ‚Ç¨
                <!-- Condicional dentro del bucle -->
                <h:panelGroup rendered="#{p.precio lt 2.0}">
                    <span style="color:green;">(¬°Oferta!)</span>
                </h:panelGroup>
            </li>
        </ui:repeat>
    </ul>

    <h2>Tabla de productos (con h:dataTable):</h2>
    <h:dataTable value="#{helloBean.productos}" var="p" border="1">
        <h:column>
            <f:facet name="header">Nombre</f:facet>
            #{p.nombre}
        </h:column>
        <h:column>
            <f:facet name="header">Precio</f:facet>
            #{p.precio} ‚Ç¨
        </h:column>
    </h:dataTable>
</h:body>
</html>
